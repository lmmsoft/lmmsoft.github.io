---
title: 【转】c/c++“Hello world!”的N种写法
date: 2010-08-14 15:12:00 +0800
layout: post
published: true
comments: true
category: 挨踢生涯
moveForm: baidu_qing
permalink: /hello-world-in-many-ways/
---
<div> <p>在初学一门编程语言的时候，写一个&ldquo;Hello world!&rdquo;程序是最常见的入门方法。通过写一个成功的&ldquo;Hello world!&rdquo;，可以实践这门语言最基本的语法特性，还可以带给自己成就感，真是一举两得。C/C++语言本身有很多特性，如果能够将这些技术分解出来变成一个个的&ldquo;Hello world!&rdquo;，并且将这些技术点到为止，貌似也算是一件善事。这里，列举了10个&ldquo;Hello world!&rdquo;程序，大家雅俗共赏一下。<br /><br />1. 最经典的&ldquo;Hello world!&rdquo;<br />&ldquo;Hello world!&rdquo;最经典的写法当然是直接用 printf 输出&ldquo;Hello world!&rdquo;这几个字符了。无论用C还是 C++，写起来都非常的简洁明了。这里把最常见的几个全部列在下面。<br /></p>#include &lt;stdio.h&gt;<br />#include &lt;iostream&gt;<br /><br />int main()<br />{<br />&nbsp;&nbsp;&nbsp;  printf(&quot;Hello world!&quot;);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  // 教科书的写法<br />&nbsp;&nbsp;&nbsp;  puts(&quot;Hello world!&quot;);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  // 我最喜欢的<br />&nbsp;&nbsp;&nbsp;  puts(&quot;Hello&quot; &quot; &quot; &quot;world!&quot;);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  // 拼接字符串<br />&nbsp;&nbsp;&nbsp;  std::cout &lt;&lt; &quot;Hello world!&quot; &lt;&lt; std::endl; // C++风格的教科书写法<br /><br />&nbsp;&nbsp;&nbsp;  return 0;<br />}<br />特别需要注意的是，在C/C++里，如果两个字符串之间除空白符以外没有任何东西，编译器会自动认为这两个字符串是连在一起的字符串。这样，如果一个字符串过长，可以用这种方法换行来写，既不浪费性能，又美观。<br /><br />2. 用宏写的&ldquo;Hello world!&rdquo;<br />在C/C++里，宏是一个神奇的东西。特别是在C语言中，宏可以帮我们做一些&ldquo;又脏又累&rdquo;的活，包括拼接代码片断、隐藏繁琐的实现细节等等。其中特别有趣的是&ldquo;#&rdquo;的用法，它可以&ldquo;提取&rdquo;参数的名字，把它变成字符串。<br />#include &lt;stdio.h&gt;<br /><br />#define Say(sth) puts(#sth)<br /><br />int main()<br />{<br />&nbsp;&nbsp;&nbsp;  return Say(Hello world!);<br />}<br />请注意，这个Hello world可是完全没有出现引号哦！<br /><br />3. 断章取义的&ldquo;Hello world!&rdquo;<br />字符串是一种常量这当然毫无疑问，但是它的类型是什么，这就需要考虑一下了。使用C++的typeid就可以这个问题的答案，而且只要是符合C或C++标准的编译器就应该是一样的结果。比如字符串&ldquo;Hello world!&rdquo;，它的类型就是 char const [13]。<br />知道了这个，就可以写出以下的&ldquo;Hello world!&rdquo;：<br />#include &lt;stdio.h&gt;<br /><br />int main()<br />{<br />&nbsp;&nbsp;&nbsp;  return puts(&amp;&quot;Do not say: Hello world!&quot;[12]);<br />}<br /><br />4. 退出时运行的&ldquo;Hello world!&rdquo;<br />大家都知道 main 函数退出意味着程序结束，可是这并不完全正确，我们完全可以在 main 函数退出以后做很多事呢&mdash;&mdash;比如说，输出&ldquo;Hello world!&rdquo;。这个功能依赖于C标准库中提供的函数 atexit()，调用这个函数并注册自己的回调函数就行。需要注意，这个函数可以调用多次，最后注册的函数最先执行。<br />#include &lt;stdio.h&gt;<br />#include &lt;stdlib.h&gt;<br /><br />void say()<br />{<br />&nbsp;&nbsp;&nbsp;  printf(&quot;world!&quot;);<br />}<br /><br />void sth()<br />{<br />&nbsp;&nbsp;&nbsp;  printf(&quot;Hello &quot;);<br />}<br /><br />int main()<br />{<br />&nbsp;&nbsp;&nbsp;  return atexit(say), atexit(sth);<br />}<br /><br />5. 读取自己的&ldquo;Hello world!&rdquo;<br />C/C++的编译器提供了一些有用的内置宏，最常用的就是 __FILE__ 和 __LINE__ 了。其中，__FILE__ 代表当前的源文件的文件名，嗯，对了，如果我们让这个程序读取自己的源文件，不就可以做一个很有意思的&ldquo;Hello world!&rdquo;了么？<br />// Hello world!<br /><br />#include &lt;iostream&gt;<br />#include &lt;fstream&gt;<br />#include &lt;string&gt;<br /><br />int main()<br />{<br />&nbsp;&nbsp;&nbsp;  std::ifstream ifs(__FILE__);<br />&nbsp;&nbsp;&nbsp;  std::string say, some, word;<br /><br />&nbsp;&nbsp;&nbsp;  ifs &gt;&gt; say &gt;&gt; some &gt;&gt; word;<br />&nbsp;&nbsp;&nbsp;  std::cout &lt;&lt; some &lt;&lt; &quot; &quot; &lt;&lt; word;<br /><br />&nbsp;&nbsp;&nbsp;  return 0;<br />}<br /><br />6. 话分两头的&ldquo;Hello world!&rdquo;<br />有了C++的类，我们就可以光明正大的在 main 函数执行之前和之后做感兴趣的事情了。我们可以声明一个全局的类的实例，这样，在 main 函数执行之前会调用这个类的构造函数，结束之后则会调用析构函数。<br />#include &lt;iostream&gt;<br /><br />class say<br />{<br />public:<br />&nbsp;&nbsp;&nbsp;  say()<br />&nbsp;&nbsp;&nbsp;  {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  std::cout &lt;&lt; &quot;Hell&quot;;<br />&nbsp;&nbsp;&nbsp;  }<br /><br />&nbsp;&nbsp;&nbsp;  ~say()<br />&nbsp;&nbsp;&nbsp;  {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  std::cout &lt;&lt; &quot;world!&quot;;<br />&nbsp;&nbsp;&nbsp;  }<br />}hello;<br /><br />int main()<br />{<br />&nbsp;&nbsp;&nbsp;  std::cout &lt;&lt; &quot;o &quot;;<br />&nbsp;&nbsp;&nbsp;  return 0;<br />}<br /><br />7. 传入模板的&ldquo;Hello world!&rdquo;<br />C++的模板功能极为强大，可以说是C++里面最艰深、最经典、最时尚的部分。一个&ldquo;Hello world!&rdquo;当然无法使用很多很高级的模板技巧，我也不想只使用模板特化这样无阻挂齿的小技巧，嗯，那就来演示一个比较罕见的用法吧。<br />#include &lt;iostream&gt;<br /><br />template &lt;char * words&gt;<br />class say<br />{<br />public:<br />&nbsp;&nbsp;&nbsp;  void operator () ()<br />&nbsp;&nbsp;&nbsp;  {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  std::cout &lt;&lt; words;<br />&nbsp;&nbsp;&nbsp;  }<br />};<br /><br />extern char hello[] = &quot;Hello world!&quot;;<br /><br />int main()<br />{<br />&nbsp;&nbsp;&nbsp;  return say&lt;hello&gt;()(), 0;<br />}<br />请注意，这个 extern 是十分必要的，只有加上了 extern，这个指针才是一个编译器间可以确定的值，也才可以参与模板运算。还有，hello 必须为数组类型，而不能为 char*，这个道理和加 extern 是一样的。<br />此外，这里还演示了 functor 的用法，嗯，关于它的优点就不在这里多说了，反正是与原生指针相比有很多好处就是了。<br /><br />8. 调用私有函数的&ldquo;Hello world!&rdquo;<br />我们知道，C++类的私有函数是不能被外界访问的，比如说 main 函数里面，它绝对不能访问类的私有函数，除非把它设为类的友元函数。不过我们还是可以用一些比较奇怪的方法访问类的私有函数&mdash;&mdash;当然，这个私有函数必须满足一个条件：它是虚函数。<br />这里就涉及到一个问题，指向虚函数的虚表放在哪里？对于 VS.Net 2003 而言，虚表是类的第一个成员，虚函数指针按照函数声明的顺序放在虚表里面。当然，这个说法并不严谨，更细节的东西还是去看看那本&ldquo;成人高钙奶粉&rdquo;吧，它会给出最权威的解答。<br />这里是一个很有意思的例子：<br />#include &lt;iostream&gt;<br />#include &lt;cstddef&gt;<br /><br />class secret<br />{<br />private:<br />&nbsp;&nbsp;&nbsp;  virtual void say()<br />&nbsp;&nbsp;&nbsp;  {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  std::cout &lt;&lt; &quot;Hello world!&quot;;<br />&nbsp;&nbsp;&nbsp;  }<br />};<br /><br />int main()<br />{<br />&nbsp;&nbsp;&nbsp;  secret word;<br />&nbsp;&nbsp;&nbsp;  (reinterpret_cast&lt;void (*)()&gt;(**(intptr_t**)(&amp;word)))();<br /><br />&nbsp;&nbsp;&nbsp;  return 0;<br />}<br /><br />9. 最暴力的&ldquo;Hello world!&rdquo;<br />最暴力的调用函数的方法是：直接修改函数的返回地址，让这个地址指向我们想要调用的函数。这也就是缓冲区溢出漏洞的应用方法了，不过里面还涉及到很多问题，在这里就不一一列举，想要了解的话，还是去 Google 吧。这里只演示一个可以在 VS.Net 2003 下可以用的&ldquo;Hello world!&rdquo;。<br />#include &lt;stdio.h&gt;<br />#include &lt;stdlib.h&gt;<br />#include &lt;stddef.h&gt;<br /><br />void say()<br />{<br />&nbsp;&nbsp;&nbsp;  puts(&quot;Hello world!&quot;);<br />&nbsp;&nbsp;&nbsp;  exit(0);<br />}<br /><br />int main()<br />{<br />&nbsp;&nbsp;&nbsp;  volatile intptr_t a = 0;<br />&nbsp;&nbsp;&nbsp;  volatile intptr_t * p = &amp;a;<br /><br />&nbsp;&nbsp;&nbsp;  *(p + 2) = (intptr_t)say;<br />&nbsp;&nbsp;&nbsp;  *(p + 3) = (intptr_t)say;<br /><br />&nbsp;&nbsp;&nbsp;  return 0;<br />}<br /><br />10. 外星人说的&ldquo;Hello world!&rdquo;<br />好了，这个&ldquo;Hello world!&rdquo;是最匪夷所思的一个了！不过它并没有涉及任何复杂的C/C++语言特性，只是看起来有点酷。你能看懂外星人在说什么不？<br />#include &lt;stdio.h&gt;<br /><br />void alien_say(char * p)<br />{<br />&nbsp;&nbsp;&nbsp;  while (putchar(*(p += *(p + 1) - *p)));<br />}<br /><br />int main()<br />{<br />&nbsp;&nbsp;&nbsp;  return alien_say(&quot;BETHO! Altec oh liryom(a loadjudas!) dowd.&quot;), 0;<br />}<br /> </div>
