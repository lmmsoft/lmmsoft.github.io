---
title: 该死的表达式求值
date: 2010-10-28 20:52:00 +0800
layout: post
published: true
comments: true
category: acm比赛
moveForm: baidu_qing
---
<div> <p>晚上七点到八点花了不到一个小时写出来的表达式求值程序，因为几个无语的错误，居然调试到现在，累计调试的时间大概有五个小时了吧，太打击自信了！</p><p>教训：写代码细心，实时检验，以免程序长了之后花数倍的时间调试</p><p>#include&lt;stack&gt;<br />//#include&lt;string&gt;<br />#include&lt;iostream&gt;</p><p>using namespace std;</p><p><br />short Com[7][7]={ {1,1,0,0,0,1,1},{1,1,0,0,0,1,1},//运算符优先级 <br />&nbsp;&nbsp;&nbsp; {1,1,1,1,0,1,1},{1,1,1,1,0,1,1},<br />&nbsp;&nbsp;&nbsp; {0,0,0,0,0,2,1},{1,1,1,1,1,1,1},{0,0,0,0,0,0,0}};<br />&nbsp;&nbsp;&nbsp;<br />int Operate(int a,char theta,int b)//计算 <br />{<br /> if(theta=='+')return a+b;<br /> if(theta=='-')return a-b;<br /> if(theta=='*')return a*b;<br /> if(theta=='/')return a/b;<br />}<br />int StoN(char z)//返回操作符代号便于计算优先级 <br />{ if(z=='+')return 0;<br /> if(z=='-')return 1;<br /> if(z=='*')return 2;<br /> if(z=='/')return 3;<br /> if(z=='(')return 4;<br /> if(z==')')return 5;<br /> if(z=='#')return 6;<br />}</p><p>int count(char s[])//主程序 <br />{<br /> stack&lt;char&gt; oper;<br /> stack&lt;int&gt; num;<br /> int aa,bb,cc,t,ccc;<br /> oper.push('#');<br /> int l=strlen(s),i,j;<br /> char temp[]=&quot;#&quot;;<br /> strcat(s,temp);<br /> //s[l+1]=35;<br /> char c,theta;<br /> i=-1;<br /> c=s[++i];<br /> while(c!='#' || oper.top()!='#')//oper.top()!='#'<br /> {<br />&nbsp;&nbsp; //if(!(c=='+' || c=='-' || c=='*' || c=='/' || c=='(' || c==')'))<br />&nbsp;&nbsp; if(c&gt;='0' &amp;&amp; c&lt;='9')<br />&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp; t=0;<br />&nbsp;&nbsp;&nbsp; while(c&gt;='0'&amp;&amp;c&lt;='9')<br />&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp; t++;<br />&nbsp;&nbsp;&nbsp;&nbsp; c=s[++i];<br />&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp; int d=atoi(s+i-t);<br />&nbsp;&nbsp;&nbsp; i--;<br />&nbsp;&nbsp;&nbsp; num.push(d);<br />&nbsp;&nbsp;&nbsp; c=s[++i];<br />&nbsp;&nbsp; }<br />&nbsp;&nbsp; else<br />&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp; cc=StoN(oper.top());<br />&nbsp;&nbsp;&nbsp; ccc=StoN(c);<br />&nbsp;&nbsp;&nbsp; //oper.pop;<br />&nbsp;&nbsp;&nbsp; switch(Com[cc][ccc])<br />&nbsp;&nbsp;&nbsp; { <br />&nbsp;&nbsp;&nbsp;&nbsp; case 0:// &lt; <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; oper.push(c);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; c=s[++i];<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; break;<br />&nbsp;&nbsp;&nbsp;&nbsp; case 2:// = <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; oper.pop();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; c=s[++i];<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; break;<br />&nbsp;&nbsp;&nbsp;&nbsp; case 1:// &gt; <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; theta=oper.top();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; oper.pop();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; bb=num.top();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; num.pop();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; aa=num.top();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; num.pop();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; num.push(Operate(aa,theta,bb));<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; break;<br />&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp; }<br /> }<br /> return num.top();<br />}</p><p>int main()<br />{<br /> int n,base;<br /> char s[100];<br /> while(1){<br /> cout&lt;&lt;&quot;输入表达式&quot;;<br /> cin&gt;&gt;s;<br /> cout&lt;&lt;&quot;key=&quot;&lt;&lt;count(s)&lt;&lt;endl;<br /> }<br /> <br /> <br /> printf(&quot;\n&quot;);<br />system(&quot;pause&quot;);<br />}<br />//4+2*3-10/5 ac<br />//2+(3+4/2)*2 ac<br />//2*(3+4/2)*2 ac<br />//2*2+(3+4) ac<br />//1+(2+3) ac</p><p>ps：百度不支持tab，晕。。。</p> </div>
