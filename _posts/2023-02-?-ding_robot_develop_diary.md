---
title:  "宝宝守护钉钉机器人开发日记"
date: 2023-02-15T00:00:00+08:00
author: lmm333
layout: post
comments: true
published: false
permalink: /ding_robot_develop_diary/
categories:
- 挨踢生涯
tags:
- 钉钉
- 机器人
---

最近在开发一个钉钉机器人，用来监控宝宝的健康状况，主要是监控宝宝的睡眠情况，以及宝宝的体温。这个机器人的主要功能是定时向宝宝的监护人发送宝宝的睡眠情况，以及宝宝的体温。这个机器人的开发过程中，遇到了很多问题，这里记录一下。

# 源起
从阿里离职后，我就把钉钉删掉了，六根清净。

去年阿里在搞钉钉迁移，工作用的部分迁移到专属钉"阿里钉"里，而个人（诸如外部组织，学校）继续，这样其实很好，两套账号体系，个人数据和公司数据彻底分开，数据安全问题会少很多，两个不同的APP，管理起来也容易。

我一直没参与，所以工作和私人的钉钉没分开。现在登陆后还有一些遗留的群，所有的组织内部群已经强制退出了，但是类似是普通群的孩子，包括娱乐群，吃喝玩乐群，信用卡群，美股群等。

和钉钉的往事此处不表，这次讲新的故事。

因为孩子上的幼儿园在用钉钉，为了家校沟通，学习又。所有又，被迫重新启用钉钉。

老师挺负责，每天会发宝宝的情况记录，还拍了很多照片，包括课堂，户外活动，食物等。

于是想到搞个机器人，存储宝宝的成长记录，并驱动各位家长和老师以宝宝为中心...

钉钉机器人我很熟啊，之前在阿里云的混合云工程效率团队，我搞了一百多个钉钉群，每个群对应一个产品，拉了工程师、项目经理、老板等，然后用钉钉机器人推送信息，驱动大家干活，哈哈。

# 开发

## 周二晚
- 原型验证
  - 看看钉钉群机器人的outgoing功能是否可用
  - -> 调试通过，可以拿到@的文字，但是拿不到引用的信息
  - -> 所以老师必须@机器人，才能拿到信息，后续要想老师提要求
- 技术选型
  - 我最熟悉的 python3+fastapi

## 周三
- 白天申请权限，和学校掰扯，我姿态很低，老师也很支持。


## 周四：
- 提高研发效率：
  - github action运行 pylint
  - ngrok做内网穿透，方便本地调试钉钉的回调
- 测试用例8个

## 周六
- 思考第一期要实现的feature:
- 收到老师发的周边，也是有图片的格式，准备去问问图片是怎么做的，精力和时间？看看能不能自动化

## 周日
- 外部存储选型
  - csv/yaml 文件本地表格存储
  - mysql + docker 
  - github action crontab 导出数据库备份
  - 钉钉群表格文档

# 当头一棒

Outgoing不能使用

怀疑是最近ChatGPT太火，机器人outgoing功能也许被滥用了，以至于钉钉做了限制，Outgoing暂时不能使用。我甚至问了孩子阿里的前同事，他们也不能用。

几天前还能用，开发好了，无异于当头一棒。

又多了很多问题。

- 企业内部开发者，可以开发企业内部专属机器人，API基本一致。
- 需要企业开发者权限
- 也许需要是群管理员？
- 群必须转成企业内部群，不能是普通群，也没加入组织的会踢出去，数据存储，聊天记录的归属，也许。反正我是要做主动记录的，问题不大。

# 上线联调

# 一期完成
- 基础统计
- 高级统计AIGC：吃了啥，哭了多久，自动表现打分
  - 能否接入国内的AI?

# 二期继续
- 计划是图片相关的技术
  - 本地保存
  - 自动生成每日图片
